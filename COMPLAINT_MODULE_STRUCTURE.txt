# COMPLAINT MANAGEMENT SYSTEM - MODULE STRUCTURE

## Overview
This document shows the complete module structure for easy migration to production.

---

## ğŸ“ Backend File Structure

```
server/src/
â”œâ”€â”€ models/
â”‚   â”œâ”€â”€ User.js [MODIFIED]
â”‚   â”‚   â””â”€â”€ Lines 128-145: Complaint management fields
â”‚   â””â”€â”€ ComplaintSchema.js [NEW]
â”‚       â””â”€â”€ Complete complaint model with all features
â”‚
â”œâ”€â”€ utils/
â”‚   â””â”€â”€ complaint/ [NEW DIRECTORY]
â”‚       â”œâ”€â”€ index.js
â”‚       â”œâ”€â”€ staffTimeLimits.js
â”‚       â””â”€â”€ complaintHelpers.js
â”‚
â”œâ”€â”€ middlewares/
â”‚   â””â”€â”€ complaintValidation.js [PENDING]
â”‚
â”œâ”€â”€ controllers/
â”‚   â””â”€â”€ complaintController.js [PENDING]
â”‚
â”œâ”€â”€ routes/
â”‚   â”œâ”€â”€ complaintRoutes.js [PENDING]
â”‚   â”œâ”€â”€ webhooks.js [PENDING]
â”‚   â””â”€â”€ index.js [TO BE MODIFIED]
â”‚
â”œâ”€â”€ services/
â”‚   â””â”€â”€ complaintNotificationService.js [PENDING]
â”‚
â””â”€â”€ templates/
    â””â”€â”€ complaintEmails.js [PENDING]
```

---

## ğŸ“ Frontend File Structure

```
client/
â”œâ”€â”€ pages/
â”‚   â”œâ”€â”€ OrderDetails.tsx [TO BE MODIFIED]
â”‚   â”œâ”€â”€ RegisterComplaint.tsx [PENDING]
â”‚   â”œâ”€â”€ ComplaintDetails.tsx [PENDING]
â”‚   â””â”€â”€ admin/
â”‚       â””â”€â”€ ComplaintManagement.tsx [PENDING]
â”‚
â”œâ”€â”€ components/
â”‚   â””â”€â”€ complaint/ [PENDING]
â”‚       â”œâ”€â”€ ComplaintCard.tsx
â”‚       â”œâ”€â”€ ComplaintChat.tsx
â”‚       â”œâ”€â”€ ComplaintStatusBadge.tsx
â”‚       â””â”€â”€ ComplaintTimeline.tsx
â”‚
â””â”€â”€ routes.tsx [TO BE MODIFIED]
```

---

## ğŸ”§ Completed Files (Phase 1)

### Backend
1. **server/src/models/User.js** âœ…
   - Modified lines: 128-145
   - Added: `staffLevel`, `allowedComplaintRegistrationDays`

2. **server/src/models/ComplaintSchema.js** âœ…
   - Complete file (new)
   - 400+ lines with full schema

3. **server/src/utils/complaint/staffTimeLimits.js** âœ…
   - Complete file (new)
   - Time limit calculation logic

4. **server/src/utils/complaint/complaintHelpers.js** âœ…
   - Complete file (new)
   - Helper functions

5. **server/src/utils/complaint/index.js** âœ…
   - Complete file (new)
   - Export aggregator

---

## ğŸš€ Migration Instructions

### To Production:
1. Copy all files from `server/src/utils/complaint/` directory
2. Copy `server/src/models/ComplaintSchema.js`
3. In User model, add lines 128-145 (complaint management fields)
4. Restart server to register new model

### Database Indexes:
Run after first deployment:
```javascript
// In MongoDB shell or migration script
db.complaints.createIndex({ orderNumber: 1 });
db.complaints.createIndex({ status: 1, createdAt: -1 });
db.complaints.createIndex({ raisedBy: 1, createdAt: -1 });
db.complaints.createIndex({ assignedTo: 1, status: 1 });
db.complaints.createIndex({ deliveryDate: 1, createdAt: 1 });
db.complaints.createIndex({ registerSource: 1 });
db.complaints.createIndex({ reopenSource: 1 });
```

---

## ğŸ“ Next Steps (Phase 2)

See COMPLAINT_SYSTEM_CHANGES.txt for detailed progress tracking.
