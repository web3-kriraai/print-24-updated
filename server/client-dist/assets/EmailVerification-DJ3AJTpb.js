import{r as n,R as D,A as S,j as e,m as j,M as A,C as O,L as $,a as F}from"./index-CWNmoqdY.js";const M=({email:u,onVerified:C,onBack:P})=>{const[o,d]=n.useState(["","","","","",""]),[m,x]=n.useState(!1),[b,f]=n.useState(!1),[p,r]=n.useState(""),[i,T]=n.useState(!1),[h,N]=n.useState(60),[R,v]=n.useState(!1),l=D.useRef([]);n.useEffect(()=>{if(h>0){const s=setInterval(()=>{N(t=>t-1)},1e3);return()=>clearInterval(s)}else v(!0)},[h]),n.useEffect(()=>{w()},[]);const w=async()=>{f(!0),r("");try{const s=await fetch(`${S}/auth/send-email-otp`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:u,signupIntent:"CUSTOMER"})}),t=await s.json();if(!s.ok){r(t.message||"Failed to send OTP"),f(!1);return}N(60),v(!1),f(!1)}catch{r("Failed to send OTP. Please try again."),f(!1)}},E=(s,t)=>{var c;if(!/^\d*$/.test(t))return;const a=[...o];a[s]=t.slice(-1),d(a),r(""),t&&s<5&&((c=l.current[s+1])==null||c.focus()),a.every(g=>g!=="")&&s===5&&y(a.join(""))},I=(s,t)=>{var a;t.key==="Backspace"&&!o[s]&&s>0&&((a=l.current[s-1])==null||a.focus())},V=s=>{s.preventDefault();const t=s.clipboardData.getData("text").slice(0,6);if(!/^\d+$/.test(t))return;const a=t.split("").concat(Array(6-t.length).fill(""));d(a),t.length===6&&y(t)},y=async s=>{var t,a;x(!0),r("");try{const c=await fetch(`${S}/auth/verify-email-otp`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:u,otp:s})}),g=await c.json();if(!c.ok){r(g.message||"Invalid OTP"),x(!1),d(["","","","","",""]),(t=l.current[0])==null||t.focus();return}T(!0),setTimeout(()=>{C()},1500)}catch{r("Verification failed. Please try again."),x(!1),d(["","","","","",""]),(a=l.current[0])==null||a.focus()}},k=s=>{s.preventDefault();const t=o.join("");t.length===6&&y(t)};return e.jsxs(j.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"max-w-md mx-auto",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-cream-100 rounded-full mb-4",children:e.jsx(A,{className:"h-8 w-8 text-cream-900"})}),e.jsx("h2",{className:"font-serif text-2xl sm:text-3xl font-bold text-cream-900",children:"Verify Your Email"}),e.jsx("p",{className:"mt-2 text-sm text-cream-600",children:"We've sent a 6-digit code to"}),e.jsx("p",{className:"font-medium text-cream-900",children:u})]}),e.jsxs("form",{onSubmit:k,className:"space-y-6",children:[e.jsx("div",{className:"flex justify-center gap-2",children:o.map((s,t)=>e.jsx("input",{ref:a=>{l.current[t]=a},type:"text",inputMode:"numeric",maxLength:1,value:s,onChange:a=>E(t,a.target.value),onKeyDown:a=>I(t,a),onPaste:t===0?V:void 0,disabled:m||i,className:`w-12 h-14 text-center text-2xl font-bold border-2 rounded-xl focus:outline-none focus:ring-2 focus:ring-cream-900 transition-all ${p?"border-red-300 bg-red-50":i?"border-green-500 bg-green-50":"border-cream-200 bg-white"} ${m||i?"opacity-50 cursor-not-allowed":""}`},t))}),p&&e.jsx(j.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"text-center text-sm text-red-500",children:p}),i&&e.jsxs(j.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},className:"flex items-center justify-center gap-2 text-green-600",children:[e.jsx(O,{className:"h-5 w-5"}),e.jsx("span",{className:"font-medium",children:"Email verified successfully!"})]}),e.jsx("div",{className:"text-center",children:R?e.jsx("button",{type:"button",onClick:w,disabled:b,className:"text-sm text-cream-900 font-medium hover:underline disabled:opacity-50",children:b?"Sending...":"Resend OTP"}):e.jsxs("p",{className:"text-sm text-cream-600",children:["Resend OTP in ",e.jsxs("span",{className:"font-medium text-cream-900",children:[h,"s"]})]})}),e.jsx("button",{type:"submit",disabled:o.some(s=>!s)||m||i,className:"w-full bg-cream-900 text-cream-50 py-3 rounded-xl font-medium hover:bg-cream-800 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:m?e.jsxs(e.Fragment,{children:[e.jsx($,{className:"h-5 w-5 animate-spin"}),"Verifying..."]}):i?e.jsxs(e.Fragment,{children:[e.jsx(O,{className:"h-5 w-5"}),"Verified"]}):e.jsxs(e.Fragment,{children:["Verify Email",e.jsx(F,{className:"h-5 w-5"})]})}),e.jsx("button",{type:"button",onClick:P,className:"w-full text-sm text-cream-600 hover:text-cream-900 transition-colors",children:"Change email address"})]})]})};export{M as default};
